---
title: "ahs_recodes"
author: "Alissa Ji"
date: "7/10/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(plyr)
library(dplyr)
```

# Recoding variables:
```{r}
# ahs_subset <- read.csv("ahs2017_hhsubset.csv")
ahs_flat <- read.csv("ahs2017_hhsubset_flat.csv")
```

# For Flat File:

## Race and ethnicity:
```{r}
# HHRACE
# levels(ahs_flat$HHRACE)
recode.hhrace <- c("'01'" = "White Only",
                   "'02'" = "Black Only",
                   "'03'" = "American Indian, Alaska Native Only",
                   "'04'" = "Asian Only",
                   "'05'" = "Hawaiian, Pacific Islander Only",
                   "'06'" = "White / Black",
                   "'07'" = "White / American Indian, Alaska Native",
                   "'08'" = "White / Asian",
                   "'09'" = "White / Hawaiian, Pacific Islander",
                   "'10'" = "Black / American Indian, Alaska Native",
                   "'11'" = "Black / Asian",
                   "'12'" = "Black / Hawaiian, Pacific Islander",
                   "'13'" = "American Indian, Alaska Native / Asian",
                   "'14'" = "Asian / Hawaiian, Pacific Islander",
                   "'15'" = "White / Black / American Indian, Alaska Native",
                   "'16'" = "White / Black /Asian",
                   "'17'" = "White / American Indian, Alaska Native / Asian",
                   "'18'" = "White / Asian / Hawaiian, Pacific Islander",
                   "'19'" = "White / Black / American Indian, Alaska Native / Asian",
                   "'20'" = "Other combinations of 2 or 3 races",
                   "'21'" = "Other combinations of 4 or more races",
                   "'-6'" = NA)
ahs_flat$HHRACE <- revalue(ahs_flat$HHRACE, recode.hhrace)

# HHSPAN2
# levels(ahs_flat$HHSPAN2)
ahs_flat$HHSPAN2 <- ahs_flat$HHSPAN
recode.hhspan2 <- c("'1'" = "Hispanic or Latinx",
                    "'2'" = "Not Hispanic or Latinx",
                    "'-6'" = NA)
ahs_flat$HHSPAN2 <- revalue(ahs_flat$HHSPAN2, recode.hhspan2)

# HHRACE2
ahs_flat$HHRACE2 <- as.character(ahs_flat$HHRACE)
ahs_flat$HHRACE2[!(ahs_flat$HHRACE2 %in% 
                     c("White Only",
                       "Black Only",
                       "American Indian, Alaska Native Only",
                       "Asian Only",
                       "Hawaiian, Pacific Islander Only"))] <- "2 or more races"
ahs_flat$HHRACE2 <- as.factor(ahs_flat$HHRACE2)
# levels(ahs_flat$HHRACE2)

# HHRACE3
## drops multiracial individuals
ahs_flat$HHRACE3 <- as.character(ahs_flat$HHRACE)
ahs_flat$HHRACE3[!(ahs_flat$HHRACE2 %in% 
                     c("White Only", "Black Only", 
                       "American Indian, Alaska Native Only", 
                       "Asian Only", "Hawaiian, Pacific Islander Only"))] <- NA
ahs_flat$HHRACE3 <- as.factor(ahs_flat$HHRACE3)

# RACE_[race]Alone
## binary variables that indicate whether or not a HH identifies as a given race (1/0)
ahs_flat <- ahs_flat %>% 
  mutate(RACE_WhiteAloneNH = ifelse(grepl("White", HHRACE) & 
                                    HHSPAN2 == "Not Hispanic or Latinx", 1, 0),
         RACE_WhiteAlone = ifelse(grepl("White", HHRACE), 1, 0),
         RACE_BlackAlone = ifelse(grepl("Black", HHRACE), 1, 0),
         RACE_ANAIAlone = ifelse(grepl("American Indian, Alaska Native Only", HHRACE), 1, 0),
         RACE_AsianAlone = ifelse(grepl("Asian Only", HHRACE), 1, 0),
         RACE_NHPIAlone = ifelse(grepl("Hawaiian, Pacific Islander Only", HHRACE), 1, 0))
         
# HHRACEAS        
# levels(ahs_flat$HHRACEAS)
recode.hhraceas <- c("'1'" = "Asian Indian only",
                     "'2'" = "Chinese only",
                     "'3'" = "Filipino only",
                     "'4'" = "Japanese only",
                     "'5'" = "Korean only",
                     "'6'" = "Vietnamese only",
                     "'7'" = "Some other Asian race only",
                     "'8'" = "Two or more Asian races",
                     "'-6'" = NA)
ahs_flat$HHRACEAS <- revalue(ahs_flat$HHRACEAS, recode.hhraceas)

# HHRACEPI
# levels(ahs_flat$HHRACEPI)
recode.hhracepi <- c("'1'" = "Native Hawaiian only",
                     "'2'" = "Guamanian or Chamorro only",
                     "'3'" = "Samoan only",
                     "'4'" = "Some other Pacific islander race only",
                     "'5'" = "Two or more Native Hawaiian or Pacific islander races",
                     "'-6'" = NA)
ahs_flat$HHRACEPI <- revalue(ahs_flat$HHRACEPI, recode.hhracepi)

# RACEETH
ahs_flat <- ahs_flat %>% mutate(RACEETH = NA)
ahs_flat$RACEETH[ahs_flat$HHSPAN2 == "Not Hispanic or Latinx" &
                   ahs_flat$HHRACE == "White Only"] <- "White Alone NH"
ahs_flat$RACEETH[ahs_flat$HHRACE == "Black Only"] <- "Black Alone"
ahs_flat$RACEETH[ahs_flat$HHRACE == "Asian Only"] <- "Asian Alone"
ahs_flat$RACEETH[ahs_flat$HHRACE ==
                   "American Indian, Alaska Native Only"] <- "AIAN Alone"
ahs_flat$RACEETH[ahs_flat$HHRACE ==
                   "Hawaiian, Pacific Islander Only"] <- "NHPI Alone"
ahs_flat$RACEETH <- as.factor(ahs_flat$RACEETH) ## TEST TO SEE IF NEED
```

## Race of household:
```{r}
# HRACE_SAME
## variable indicating that races of all in household are same
# var.races <- colnames(ahs_flat)[grepl("^RACE\\d", names(ahs_flat))]
# var.races2 <- paste0('ahs_flat$', var.races)
# var.races.full <- paste(var.races2,collapse="==")
# ahs_flat %>% mutate(HRACE_SAME = (eval(parse(text = var.races.full))))
```


## Geography and other demographic variables:
```{r}
# levels(ahs_flat$DIVISION)
recode.division <- c("'1'" = "New England",
                     "'2'" = "Middle Atlantic",
                     "'3'" = "East North Central",
                     "'4'" = "West North Central",
                     "'5'" = "South Atlantic",
                     "'6'" = "East South Central",
                     "'7'" = "West South Central",
                     "'8'" = "Mountain",
                     "'9'" = "Pacific")
ahs_flat$DIVISION <- revalue(ahs_flat$DIVISION, recode.division)

# levels(ahs_flat$BLD)
ahs_flat$BLD2 <- ifelse(ahs_flat$BLD == "'01'", "Mobile home or trailer",
                        ifelse(ahs_flat$BLD %in% c("'02'", "'03'"),
                               "One-family house",
                               ifelse(ahs_flat$BLD == "'10'",
                                      "Boat, RV, van, etc.", "Apartments")))
ahs_flat$BLD2 <- as.factor(ahs_flat$BLD2)
# recode.bld <- c("'01'" = "Mobile home or trailer",
#                 "'02'" = "One-family house", # detached
#                 "'03'" = "One-family house", # attached
#                 "'04'" = "Apartments",
#                 "'05'" = "Apartments",
#                 "'06'" = "Apartments",
#                 "'07'" = "Apartments",
#                 "'08'" = "Apartments",
#                 "'09'" = "Apartments",
#                 "'10'" = "oat, RV, van, etc.")
# ahs_flat$BLD <- revalue(ahs_flat$BLD, recode.bld)

# levels(ahs_flat$TENURE)
recode.tenure <- c("'1'" = "Owned or being bought by someone in your household",
                   "'2'" = "Renter",
                   "'3'" = "Occupied without payment of rent",
                   "'-6'" = NA)
ahs_flat$TENURE <- revalue(ahs_flat$TENURE, recode.tenure)
```

## Housing variables:
```{r}
ahs_flat$TOTHCAMT[ahs_flat$TOTHCAMT < 0] <- NA

# levels(ahs_flat$HUDSUB)
recode.hudsub <- c("'1'" = "Public housing tenants and tenants in privately owned assisted housing units",
                   "'2'" = "Voucher recipients",
                   "'3'" = "All other renter occupied units",
                   "'-6'" = NA)
ahs_flat$HUDSUB <- revalue(ahs_flat$HUDSUB, recode.hudsub)

# levels(ahs_flat$RENTCNTRL)
recode.rentcntrl <- c("'1'" = "Rent control or stabilization",
                      "'2'" = "No rent control or stabilization",
                      "'-9'" = NA,
                      "'-6'" = NA)
ahs_flat$RENTCNTRL <- revalue(ahs_flat$RENTCNTRL, recode.rentcntrl)

# levels(ahs_flat$RENTSUB)
recode.rentsub <- c("'1'" = "Public housing",
                    "'2'" = "Portable voucher",
                    "'3'" = "Non-portable voucher",
                    "'4'" = "Other government subsidy",
                    "'5'" = "Rent reduction requiring annual recertification not reported elsewhere",
                    "'6'" = "Rent reduction because household member works for owner",
                    "'7'" = "Rent reduction because household member related to owner",
                    "'8'" = "No rental subsidy or reduction",
                    "'-9'" = NA,
                    "'-6'" = NA)
ahs_flat$RENTSUB <- revalue(ahs_flat$RENTSUB, recode.rentsub)
```

## Export as `ahs2017_flat_r`:
```{r}
write.csv(ahs_flat, "ahs2017_flat_r.csv")
```
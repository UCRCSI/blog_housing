---
title: "ahs_recodes"
author: "Alissa Ji"
date: "6/30/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(plyr)
library(dplyr)
```

# Recoding variables:
```{r}
ahs_subset <- read.csv("ahs2017_hhsubset.csv")
```

## Race and ethnicity:
```{r}
# levels(ahs_subset$HHRACE)
recode.hhrace <- c("'01'" = "White Only",
                   "'02'" = "Black Only",
                   "'03'" = "American Indian, Alaska Native Only",
                   "'04'" = "Asian Only",
                   "'05'" = "Hawaiian, Pacific Islander Only",
                   "'06'" = "White / Black",
                   "'07'" = "White / American Indian, Alaska Native",
                   "'08'" = "White / Asian",
                   "'09'" = "White / Hawaiian, Pacific Islander",
                   "'10'" = "Black / American Indian, Alaska Native",
                   "'11'" = "Black / Asian",
                   "'12'" = "Black / Hawaiian, Pacific Islander",
                   "'13'" = "American Indian, Alaska Native / Asian",
                   "'14'" = "Asian / Hawaiian, Pacific Islander",
                   "'15'" = "White / Black / American Indian, Alaska Native",
                   "'16'" = "White / Black /Asian",
                   "'17'" = "White / American Indian, Alaska Native / Asian",
                   "'18'" = "White / Asian / Hawaiian, Pacific Islander",
                   "'19'" = "White / Black / American Indian, Alaska Native / Asian",
                   "'20'" = "Other combinations of 2 or 3 races",
                   "'21'" = "Other combinations of 4 or more races",
                   "'-6'" = NA)
ahs_subset$HHRACE <- revalue(ahs_subset$HHRACE, recode.hhrace) 

ahs_subset$HHRACE2 <- as.character(ahs_subset$HHRACE)
ahs_subset$HHRACE2[!(ahs_subset$HHRACE2 %in% 
                     c("White Only", "Black Only", 
                       "American Indian, Alaska Native Only", 
                       "Asian Only", "Hawaiian, Pacific Islander Only"))] <- "2 or more races"
ahs_subset$HHRACE2 <- as.factor(ahs_subset$HHRACE2)
# levels(ahs_subset$HHRACE2)

# levels(ahs_subset$HHRACEAS)
recode.hhraceas <- c("'1'" = "Asian Indian only",
                     "'2'" = "Chinese only",
                     "'3'" = "Filipino only",
                     "'4'" = "Japanese only",
                     "'5'" = "Korean only",
                     "'6'" = "Vietnamese only",
                     "'7'" = "Some other Asian race only",
                     "'8'" = "Two or more Asian races",
                     "'-6'" = NA)
ahs_subset$HHRACEAS <- revalue(ahs_subset$HHRACEAS, recode.hhraceas)

# levels(ahs_subset$HHRACEPI)
recode.hhracepi <- c("'1'" = "Native Hawaiian only",
                     "'2'" = "Guamanian or Chamorro only",
                     "'3'" = "Samoan only",
                     "'4'" = "Some other Pacific islander race only",
                     "'5'" = "Two or more Native Hawaiian or Pacific islander races",
                     "'-6'" = NA)
ahs_subset$HHRACEPI <- revalue(ahs_subset$HHRACEPI, recode.hhracepi)

# levels(ahs_subset$HHSPAN2)
ahs_subset$HHSPAN2 <- ahs_subset$HHSPAN
recode.hhspan2 <- c("'1'" = "Spanish, Hispanic, and/or Latinx",
                    "'2'" = "Not Spanish, Hispanic, or Latinx",
                    "'-6'" = NA)
ahs_subset$HHSPAN2 <- revalue(ahs_subset$HHSPAN2, recode.hhspan2)

ahs_subset$RACEETH <- NA
ahs_subset$RACEETH[ahs_subset$HHSPAN2 == "Not Spanish, Hispanic, or Latinx" &
                     ahs_subset$HHRACE2 == "White Only"] <- "Non-Hispanic White"
ahs_subset$RACEETH[ahs_subset$HHSPAN2 == 
                     "Spanish, Hispanic, and/or Latinx"] <- "Hispanic or Latinx"
ahs_subset$RACEETH[ahs_subset$HHSPAN2 == "Not Spanish, Hispanic, or Latinx" &
                     ahs_subset$HHRACE2 == "Black Only"] <- "Non-Hispanic Black"
ahs_subset$RACEETH[ahs_subset$HHSPAN2 == "Not Spanish, Hispanic, or Latinx" &
                     ahs_subset$HHRACE2 == "Asian Only"] <- "Non-Hispanic Asian"
ahs_subset$RACEETH[ahs_subset$HHSPAN2 == 
                     "Not Spanish, Hispanic, or Latinx" & ahs_subset$HHRACE2 == 
                     "American Indian, Alaska Native Only"] <- "Non-Hispanic American Indian, Alaska Native"
ahs_subset$RACEETH[ahs_subset$HHSPAN2 == 
                     "Not Spanish, Hispanic, or Latinx" & ahs_subset$HHRACE2 == 
                     "Hawaiian, Pacific Islander Only"] <- "Non-Hispanic Hawaiian, Pacific Islander"
ahs_subset$RACEETH[ahs_subset$HHSPAN2 == "Not Spanish, Hispanic, or Latinx" &
                     ahs_subset$HHRACE2 == "2 or more races"] <- "Other"
ahs_subset$RACEETH[!(ahs_subset$HHSPAN2 %in% 
                       c("Spanish, Hispanic, and/or Latinx",
                         "Not Spanish, Hispanic, or Latinx"))] <-"Other"
ahs_subset$RACEETH <- as.factor(ahs_subset$RACEETH)
```

## Geography and other demographic variables:
```{r}
# levels(ahs_subset$DIVISION)
recode.division <- c("'1'" = "New England",
                     "'2'" = "Middle Atlantic",
                     "'3'" = "East North Central",
                     "'4'" = "West North Central",
                     "'5'" = "South Atlantic",
                     "'6'" = "East South Central",
                     "'7'" = "West South Central",
                     "'8'" = "Mountain",
                     "'9'" = "Pacific")
ahs_subset$DIVISION <- revalue(ahs_subset$DIVISION, recode.division)

# levels(ahs_subset$BLD)
ahs_subset$BLD2 <- ifelse(ahs_subset$BLD == "'01'", "Mobile home or trailer",
                         ifelse(ahs_subset$BLD %in% c("'02'", "'03'"), 
                                "One-family house",
                                ifelse(ahs_subset$BLD == "'10'", 
                                "Boat, RV, van, etc.", "Apartments")))
ahs_subset$BLD2 <- as.factor(ahs_subset$BLD2)
# recode.bld <- c("'01'" = "Mobile home or trailer",
#                 "'02'" = "One-family house", # detached
#                 "'03'" = "One-family house", # attached
#                 "'04'" = "Apartments",
#                 "'05'" = "Apartments",
#                 "'06'" = "Apartments",
#                 "'07'" = "Apartments",
#                 "'08'" = "Apartments",
#                 "'09'" = "Apartments",
#                 "'10'" = "oat, RV, van, etc.")
# ahs_subset$BLD <- revalue(ahs_subset$BLD, recode.bld)

# levels(ahs_subset$TENURE)
recode.tenure <- c("'1'" = "Owned or being bought by someone in your household",
                   "'2'" = "Renter",
                   "'3'" = "Occupied without payment of rent",
                   "'-6'" = NA)
ahs_subset$TENURE <- revalue(ahs_subset$TENURE, recode.tenure)
```

## Housing variables:
```{r}
ahs_subset$TOTHCAMT[ahs_subset$TOTHCAMT < 0] <- NA

# levels(ahs_subset$HUDSUB)
recode.hudsub <- c("'1'" = "Public housing tenants and tenants in privately owned assisted housing units",
                   "'2'" = "Voucher recipients",
                   "'3'" = "All other renter occupied units",
                   "'-6'" = NA)
ahs_subset$HUDSUB <- revalue(ahs_subset$HUDSUB, recode.hudsub)

# levels(ahs_subset$RENTCNTRL)
recode.rentcntrl <- c("'1'" = "Rent control or stabilization",
                      "'2'" = "No rent control or stabilization",
                      "'-9'" = NA,
                      "'-6'" = NA)
ahs_subset$RENTCNTRL <- revalue(ahs_subset$RENTCNTRL, recode.rentcntrl)

# levels(ahs_subset$RENTSUB)
recode.rentsub <- c("'1'" = "Public housing",
                    "'2'" = "Portable voucher",
                    "'3'" = "Non-portable voucher",
                    "'4'" = "Other government subsidy",
                    "'5'" = "Rent reduction requiring annual recertification not reported elsewhere",
                    "'6'" = "Rent reduction because household member works for owner",
                    "'7'" = "Rent reduction because household member related to owner",
                    "'8'" = "No rental subsidy or reduction",
                    "'-9'" = NA,
                    "'-6'" = NA)
ahs_subset$RENTSUB <- revalue(ahs_subset$RENTSUB, recode.rentsub)
```

## Export as `ahs2017_hhsubset_r`:
```{r}
var <- c("HHRACE", "HHRACE2", "HHRACEAS", "HHRACEPI", "HHSPAN2", "RACEETH",
         "DIVISION", "BLD2", "TENURE", "TOTHCAMT",
         "HUDSUB", "RENTCNTRL", "RENTSUB")
ahs_subset_r <- ahs_subset[,var]
write.csv(ahs_subset_r, "ahs2017_hhsubset_r.csv")
```